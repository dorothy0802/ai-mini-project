import google.generativeai as genai
import os

# --- [중요!] API 키 설정 ---
# GitHub에 키가 올라가면 안 됩니다. 
# 이 코드를 실행하기 전에, 터미널(명령 프롬프트)에서 
# (Windows) set GOOGLE_API_KEY="여기에-복사한-API-키-붙여넣기"
# 위 명령어를 먼저 실행해주세요.
# -------------------------

# 1. API 키 설정 (환경 변수에서 안전하게 불러오기)
api_key = os.environ.get("GOOGLE_API_KEY")
genai.configure(api_key=api_key)

if not api_key:
    print("---------------------------------------------------------")
    print("!! 치명적 오류: GOOGLE_API_KEY 환경 변수가 설정되지 않았습니다.")
    print("!! 터미널에서 'set GOOGLE_API_KEY=...'를 먼저 실행하세요.")
    print("---------------------------------------------------------")
else:
    try:
        # 2. AI 모델 초기화 (작동 확인된 모델 이름으로!)
        model = genai.GenerativeModel('models/gemini-pro-latest')

        print("--- 간단한 Gemini 챗봇 데모 ---")
        print("종료하시려면 'exit'을 입력하세요.")

        # 3. 채팅 루프 시작 (데모 기능)
        while True:
            try: # <<< [수정] try 블록을 루프 안으로 이동시켰습니다.
                # 3-1. 사용자 입력 받기
                user_input = input("You: ")
                
                if user_input.lower() == 'exit':
                    print("챗봇을 종료합니다.")
                    break

                # 3-2. (수정) 빈 입력 방지
                if not user_input.strip():
                    print("Gemini: 아무것도 입력되지 않았습니다. 질문을 입력해주세요.")
                    continue
                
                # 3-3. AI 모델에 입력 전달 및 응답 생성 (핵심 기능)
                response = model.generate_content(user_input)
                
                # 3-4. AI의 응답 출력
                print(f"Gemini: {response.text}")

            except BaseException as e: # <<< [수정] 모든 오류(유령 오류 포함)를 잡습니다.
                print(f"!! 런타임 오류가 발생했습니다: {e}")
                print(f"!! 오류 타입: {type(e)}")
                # 오류가 나도 죽지 않고, 다시 질문을 받도록 루프가 계속됩니다.

    except BaseException as e: # <<< [수정] 모델 초기화 등에서 오류가 날 경우
        print(f"!! 시작 오류가 발생했습니다: {e}")
        print("!! GOOGLE_API_KEY가 올바른지, 인터넷이 연결되었는지 확인하세요.")